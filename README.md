# acnh_flowers
养花资料
TLDR 结论
## 原理
动森的花杂交是以孟德尔的杂交模型为基础的，每种花有若干等位基因，不同基因型会表现出不同的花色。
|花|等位基因数量| 基因型数量| 表现型数量|
|---|---|---|---|
|玫瑰|4|81|8(+1)|
|波斯菊|3|27|6|
|风信子|3|27|7|
|百合|3|27|6|
|菊花|3|27|6|
|三色堇|3|27|6|
|郁金香|3|27|7|
|银莲花|3|27|6|

基因层面，根据孟德尔的模型，我们是能知道很多的，比如两个基因型交配，能得到什么基因，各有多少概率。这个我算好了，打表在[csv/table3.csv](csv/table3.csv)，[csv/table4.csv](csv/table4.csv)

但是花色层面，我们没有先验知识。只能借助于破解资料。
[google doc](https://docs.google.com/spreadsheets/d/11pRCX8G0xGizSYWgVhoUSu7pE-MV7AOprBcgSY1whB4)
从资料我们知道什么基因会有什么花色,资料已经下载放在csv目录下。

根据上面的信息，已经足够对杂交起到足够的指导作用了，我们能够知道什么花色交配能出什么花色。但是关键的是概率，我们等不了无限的时间来等蓝玫瑰开花，尽管从上面的资料我们知道完全杂合体的粉色玫瑰(`01,01,01,01`)可以开出任何花色。


## 概率的疑问
> “概率我们早已经知道了。”

曾经我也这么认为，给出两个基因型，用高中知识就能求出任何子代的基因型的概率，网上的资料也是这么算的。这个repo的之前版本也是计算的基因概率来搜索种花方法的。

仔细的推敲一下基因算概率的问题。
- 波斯菊的红种子`11,00,00`和黄种子`00,11,01`，他们的后代会是
  基因|概率
  -|-
  `01,01,00`|50%
  `01,01,01`|50%

  于是得出了50%是一种花色，50%是另一种花色的结论吗？

  不！这两种基因型的花色都是橙色，红种子+黄种子 100% 出橙色。

- 你从红种子和黄种子种出了2朵橙色，然而你不知道这个橙色究竟是`01,01,00`还是`01,01,01`。假设都是`01,01,00`，那么可以出表
  基因|概率|花色
  -|-|-
  `00,00,00`|6.25%|白
  `01,00,00`|12.5%|粉
  `11,00,00`|6.25%|红
  `00,01,00`|12.5%|黄
  `01,01,00`|25%|橙
  `11,01,00`|12.5%|橙
  `00,11,00`|6.25%|黄
  `01,11,00`|12.5%|红
  `11,11,00`|6.25%|黑

  一朵是`01,01,00`一朵是`01,01,01`和两朵都是`01,01,01`都能照此计算。

  但是回到的假设，你并不知道两朵花到底是这3种情况中的哪一种，于是概率的用处就开始模糊了。
这里的重点是，有2层数据，一层是基因，一层是花色。我们只能通过花色来选花，而基因层对我们来说是不可知的，至少是难知道的。当然知道基因型，上面的计算没什么问题。甚至通过长期实验，可以做假设检验来确定一朵花的基因型。但这不切实际。
回到之前repo版本的问题。你算了，但是发现结果很散，很难整理，而且结果不是常见的数据结构，子代的数量越算越多，而且会返祖回到父代，计算量和逻辑组织的双重压力。

于是我换到模拟的思路。

## 这个repo计算的概率
由上面知道，从基因计算的概率，虽然准确，但是并不符合实际。我们需要在基因不完全确定的情况下，依据花色来计算实际可用的概率，不过着手点还是基因。

分析一下，实际游戏中的能确定基因型的操作有
1. 种花种子，基本有3色，基因是确定的。
2. 杂交花，知道是从哪两朵花交来的，能知道基因的范围
3. 自我复制，能有未知但确定的基因
4. 野岛的花，基因也是固定的

岛花的基因其实不确定，因为一下雨就都乱了，不好做稳定出花的原材料。
而野岛的花，并不方便入手，所以暂时放弃不纳入考虑。
而自我复制，虽然是确定的基因，但不会有新花色出现，所以必须和杂交一起操作，先复制自己，然后自己和自己杂交，才是一个有用的操作，这里把这两个合并起来的操作叫做**自交**。

计算各个操作的概率，主要是计算各种条件概率：
1. 种子，完全确定的基因和花色，概率是显然的。
2. 自交，先是从来源确定各个基因的概率，然后各个基因的概率再乘上基因自己和自己杂交的出基因的条件概率。
3. 杂交，先得到两方自身的基因的概率，然后乘上确定基因时子代基因的条件概率。

模拟一下，会发现种花过程其实还有一个显然的步骤，看花色。我们不会盲目地把杂交出的子代不管花色直接进行下一代杂交，而是会把需要的花色移到另一个地方去继续杂交。这个步骤也是一个杂交之后计算概率的重要步骤，上面的概率主要还是在计算基因的概率，而此处是对基因依据表现型花色的分组，所以是一个基因概率求和得到花色概率的过程。

下面是模拟结果

## 花色指南
### 波斯菊

异色花有3种，橙，粉，黑。

```
橙 = 种子红+种子黄 100%
```
```
粉 = 种子红+种子白 100%
```
黑色比较难出，最高也就14%。提供2种养法
- 欧洲人种法
   ```
  1. 种子红+种子黄 100% 出橙1
  2. 橙1自交 5.47% 出黑
   ```
- 稳妥种法
  ```
  1. 种子红+种子黄 100% 出橙1
  2. 橙1 + 种子红 50% 出橙2
  3. 橙2 自交 14.65% 出黑
  ```

### 风信子

异色有4种，橙，粉，蓝，紫
```
橙 = 种子红+种子黄 50%
```
```
粉 = 种子红+种子白 50%
```
```
蓝 = 种子白+种子白 25%
```
- 欧洲人出紫法
  ```
  1. 种子红+种子黄 50% 出橙1
  2. 橙1自交 6.25%出紫
  ```
- 稳妥打法
  ```
  1. 种子红+种子黄 50% 出 橙1
  2. 橙1 +种子黄 50% 出橙2
  3. 橙2 自交 15.62% 出紫
  ```
- 出法3
  ```
  1.红黄 50% 橙1
  2.橙色1+红 12.5% 蓝2
  3. 蓝2 自交 25% 紫
  ```

### 百合
异色有3种，黑，粉，橙
```
黑 = 种子红+种子红 25%
```
```
橙 = 种子红+种子黄 50%
```
```
粉 = 种子红+种子白 50%
```
### 菊花
异色花有3种，紫，粉，绿
```
紫 = 种子白+种子白 25%
```
```
粉 = 种子红 +种子白 100%
```
- 欧洲绿法
  ```
  1. 种子红+ 种子黄 100% 出黄1(唯一基因)
  2. 黄1自交或者黄1+黄1杂交 6.25%出绿
  ```
- 稳妥绿
  ```
  1. 种子红+种子黄 100% 出黄1(唯一基因)
  2. 黄1+种子黄 或者 黄1+种子红 25% 出紫2
  3. 紫2 自交 25% 出绿
  ```
### 三色堇
异色花有3种，橙，蓝，紫
```
橙 = 种子红+种子黄 100%
```
```
蓝= 种子白+种子白 25%
```

紫比较难，
- 欧洲出法
  ```
  1.种子红+种子白 100% 红1
  2. 红1 自交 3.12%出紫
  ```
- 稍微好一点的做法
  ```
  1. 种子红+ 种子白 100%  红1
  2. 种子白+ 种子白 25% 蓝1
  3. 红1+蓝1 25% 蓝2
  4. 蓝2 自交 12.5% 紫
  ```

### 郁金香
异色4种，橙，粉，紫，黑
```
橙 = 种子红+种子黄 50%
```
```
粉 = 种子红+种子白 50%
```
```
黑 = 种子红+种子红 25%
```
- 欧洲紫
  ```
  1. 种子红+ 种子黄 出 橙1(唯一基因) 50% 黄1(唯一基因) 50%
  2. 橙1 自交 或者 黄1 自交 6.25% 出紫
  ```
- 普通紫
  ```
  1. 种子红+ 种子白 50% 黄1
  2. 黄1+种子黄 25% 橙1
  3. 橙1 自交 15.62% 出紫
  ```
### 银莲花
异色3种，蓝，紫，粉
```
粉 = 种子红 + 种子橙 100%
```
```
蓝= 种子白 + 种子白 25%
```
- 欧洲紫
  ```
  1. 种子红 + 种子白  100% 出 红1
  2. 红1 自交 3.12% 出紫
  ```
- 普通紫
  ```
  1. 种子红+种子白 100% 红1
  2. 种子白 + 种子白 25% 出 蓝1
  3. 红1 + 蓝1 25% 出 蓝2
  4. 蓝2 自交 12.5% 出 紫
  ```
### 玫瑰
异色5种，橙，紫，粉，黑，蓝
```
紫 = 种子白 + 种子白 25%
```
```
橙 = 种子红 + 种子黄 50%
```
```
粉 = 种子红 + 种子白 50%
```
```
黑 = 种子红 + 种子红 25%
```
蓝玫瑰是本游戏最难出的花了，多提供几种方法
- 欧洲蓝1
  ```
  1. 种子红 + 种子白  50% 出 红1
  2. 红1 + 种子黄 12.5% 出红2
  3. 红2 自交 1.56% 出蓝
  ```
- 欧洲蓝2
  ```
  1. 种子红+ 种子黄 50% 橙1
  2. 种子黄+种子白 50% 白1
  3. 黄1 +白1 25% 橙2
  4. 橙2 自交 1.56% 蓝
  ```
- 蓝3
  ```
  1. 种子红+种子黄 50% 出 橙1
  2. 橙1 +种子黄 50% 出橙2
  3. 种子黄+种子白 50% 出 白1
  4. 白1 自交 18.75% 出紫2
  5. 橙2 和 紫2 自交 12.5% 出橙3
  6. 橙3 自交 6.25% 出 蓝
  ```
- 蓝4
  ```
  1. 种子红+种子黄 50% 出 橙1
  2. 种子黄+种子白 50% 出 白1
  3. 橙1 + 白1 25% 出 橙2
  4. 橙2 自交 9.375% 出 红3
  5. 红3 自交 8.333%  出现 蓝玫瑰
  ```

## 上限概率
**假设我们没有花色X，想出花色X，并且我们有了所有除花色X的所有花色的所有基因型，而且我们明确知道这个基因型是什么，我们最好可以做到多少概率出花？**
类似于上帝视角，如果这个概率和我们上面给出的方案一致，说明上面的方法是最优的。
概率计算很容易，列表如下
花+花色|上限概率
-|-|-
橙玫瑰|100%|
紫玫瑰|100%|
粉玫瑰|100%|
黑玫瑰|50%|
蓝玫瑰|25%|
橙波斯菊|100%|
粉波斯菊|100%|
黑波斯菊|50%|
橙风信子|100%|
粉风信子|100%|
蓝风信子|100%|
紫风信子|25%|
橙百合|100%|
粉百合|100%|
黑百合|50%|
紫菊花|100%|
粉菊花|100%|
绿菊花|50%|
橙三色堇|100%|
蓝三色堇|50%|
紫三色堇|25%|
橙郁金香|100%|
粉郁金香|100%|
黑郁金香|50%|
紫郁金香|25%|
粉银莲花|100%|
蓝银莲花|50%|
紫银莲花|25%|